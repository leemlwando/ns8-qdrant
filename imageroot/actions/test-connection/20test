#!/usr/bin/env python3

import json
import sys
import requests
import os

# Read input data
data = json.load(sys.stdin)

# For testing, we always use localhost since we're testing the local instance
host = 'localhost'
port = int(data.get('port', 6333))
api_key = data.get('api_key', '')

try:
    headers = {}
    if api_key:
        headers['Authorization'] = f'Bearer {api_key}'
    
    # Test connection to Qdrant
    response = requests.get(
        f'http://{host}:{port}/cluster',
        headers=headers,
        timeout=10
    )
    
    if response.status_code == 200:
        result = response.json()
        json.dump({
            "connection_successful": True,
            "qdrant_version": result.get('result', {}).get('version', 'unknown')
        }, fp=sys.stdout)
    else:
        json.dump({
            "connection_successful": False,
            "error": f"HTTP {response.status_code}: {response.text}"
        }, fp=sys.stdout)
        sys.exit(1)

except requests.exceptions.RequestException as e:
    json.dump({
        "connection_successful": False,
        "error": str(e)
    }, fp=sys.stdout)
    sys.exit(1)
