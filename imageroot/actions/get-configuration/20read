#!/usr/bin/env python3

#
# Copyright (C) 2025 Lee M. Lwando
# SPDX-License-Identifier: GPL-3.0-or-later
#

import json
import sys
import agent
import os

# Default configuration
default_config = {
    "http_port": 6333,
    "grpc_port": 6334,
    "api_key": "",
    "log_level": "INFO",
    "storage_path": ""
}

# Try to read saved configuration
config_file = 'config/module_config.json'
if os.path.exists(config_file):
    try:
        with open(config_file, 'r') as f:
            config = json.load(f)
    except (json.JSONDecodeError, IOError):
        config = default_config
else:
    config = default_config

# Ensure all required fields are present
for key, value in default_config.items():
    if key not in config:
        config[key] = value

json.dump(config, fp=sys.stdout)
