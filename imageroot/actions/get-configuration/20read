#!/usr/bin/env python3

#
# Copyright (C) 2023 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import json
import sys
import os
import agent

config = {
    "ApiKey": "",
    "EnableWebUI": True,
    "HttpsEnabled": True,
    "CustomPath": "/qdrant"
}

try:
    # Try to read from config file first
    config_file_path = os.path.join(os.environ["STATE_DIR"], "config.json")
    with open(config_file_path, "r") as f:
        stored_config = json.load(f)
        config.update(stored_config)
except FileNotFoundError:
    # Fallback to reading from environment file for API key
    try:
        with open(os.path.join(os.environ["STATE_DIR"], "qdrant.env"), "r") as f:
            for line in f:
                if line.startswith("QDRANT__SERVICE__API_KEY="):
                    config["ApiKey"] = line.strip().split("=", 1)[1]
    except FileNotFoundError:
        pass

json.dump(config, fp=sys.stdout)
